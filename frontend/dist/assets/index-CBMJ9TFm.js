import{d as oe,c as T,a as u,b as e,w as o,y as ae,n as y,j as d,k as $,r as n,z as ne,o as _,i as r,F as se,m as re,t as v,v as j,E as P}from"./index-DejdUQV-.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"tasks"},ie={class:"toolbar"},ue={class:"toolbar-left"},_e={class:"toolbar-right"},me={class:"task-name"},ce={class:"name"},ge={class:"pagination"},fe=oe({__name:"index",setup(ye){const B=d(!1),w=d(1),h=d(20),D=d(0),m=$({project:null,status:"",keyword:""}),E=d([{id:1,yacht_name:"海鹰号"},{id:2,yacht_name:"蓝鲸号"}]),N=d([{id:1,task_no:"1.1",name:"飞桥结构设计交付",task_type:"design",status:"completed",priority:"high",progress_percent:100,manager_name:"张三",plan_start:"2024-01-15",plan_end:"2024-02-15"},{id:2,task_no:"1.2",name:"船体结构生产放样及制作",task_type:"hull_construction",status:"in_progress",priority:"urgent",progress_percent:65,manager_name:"李四",plan_start:"2024-02-01",plan_end:"2024-04-30"},{id:3,task_no:"1.3",name:"外板及甲板矫正",task_type:"hull_construction",status:"not_started",priority:"medium",progress_percent:0,manager_name:"王五",plan_start:"2024-03-01",plan_end:"2024-05-15"}]),c=d(!1),b=d(!1),x=d(null),s=$({work_hours:8,progress_percent:0,description:"",photos:[]}),F=a=>({not_started:"info",in_progress:"primary",completed:"success",delayed:"danger",cancelled:"info"})[a]||"info",L=a=>({not_started:"未开始",in_progress:"进行中",completed:"已完成",delayed:"延期",cancelled:"已取消"})[a]||a,R=a=>({design:"设计",hull_construction:"船体制作",procurement:"采购配料",outfitting:"舾装",interior:"内装",commissioning:"调试"})[a]||a,I=()=>{},M=a=>{},q=a=>{},A=a=>{x.value=a,s.progress_percent=a.progress_percent||0,s.work_hours=8,s.description="",s.photos=[],c.value=!0},G=a=>{s.photos.push(a.url)},H=async()=>{b.value=!0;try{await new Promise(a=>setTimeout(a,500)),P.success("报工成功"),c.value=!1}catch(a){P.error(a.message||"报工失败")}finally{b.value=!1}};return(a,t)=>{const C=n("Plus"),k=n("el-icon"),i=n("el-button"),J=n("Calendar"),g=n("el-option"),z=n("el-select"),K=n("Search"),U=n("el-input"),p=n("el-table-column"),V=n("el-tag"),O=n("el-progress"),Q=n("el-table"),W=n("el-pagination"),f=n("el-form-item"),X=n("el-input-number"),Y=n("el-slider"),Z=n("el-upload"),ee=n("el-form"),te=n("el-dialog"),le=ne("loading");return _(),T("div",de,[u("div",ie,[u("div",ue,[e(i,{type:"primary",onClick:I},{default:o(()=>[e(k,null,{default:o(()=>[e(C)]),_:1}),t[11]||(t[11]=r(" 新建任务 ",-1))]),_:1}),e(i,{onClick:t[0]||(t[0]=l=>a.$router.push("/tasks/gantt"))},{default:o(()=>[e(k,null,{default:o(()=>[e(J)]),_:1}),t[12]||(t[12]=r(" 甘特图 ",-1))]),_:1})]),u("div",_e,[e(z,{modelValue:m.project,"onUpdate:modelValue":t[1]||(t[1]=l=>m.project=l),placeholder:"选择项目",clearable:"",style:{width:"150px"}},{default:o(()=>[(_(!0),T(se,null,re(E.value,l=>(_(),y(g,{key:l.id,label:l.yacht_name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(z,{modelValue:m.status,"onUpdate:modelValue":t[2]||(t[2]=l=>m.status=l),placeholder:"任务状态",clearable:"",style:{width:"120px"}},{default:o(()=>[e(g,{label:"未开始",value:"not_started"}),e(g,{label:"进行中",value:"in_progress"}),e(g,{label:"已完成",value:"completed"}),e(g,{label:"延期",value:"delayed"})]),_:1},8,["modelValue"]),e(U,{modelValue:m.keyword,"onUpdate:modelValue":t[3]||(t[3]=l=>m.keyword=l),placeholder:"搜索任务",style:{width:"200px"},clearable:""},{prefix:o(()=>[e(k,null,{default:o(()=>[e(K)]),_:1})]),_:1},8,["modelValue"])])]),ae((_(),y(Q,{data:N.value,"row-key":"id","default-expand-all":""},{default:o(()=>[e(p,{type:"index",width:"50"}),e(p,{prop:"task_no",label:"序号",width:"80"}),e(p,{prop:"name",label:"任务名称","min-width":"200"},{default:o(({row:l})=>[u("div",me,[u("span",ce,v(l.name),1),l.priority==="urgent"?(_(),y(V,{key:0,type:"danger",size:"small"},{default:o(()=>[...t[13]||(t[13]=[r("紧急",-1)])]),_:1})):l.priority==="high"?(_(),y(V,{key:1,type:"warning",size:"small"},{default:o(()=>[...t[14]||(t[14]=[r("高",-1)])]),_:1})):j("",!0)])]),_:1}),e(p,{prop:"task_type",label:"类型",width:"100"},{default:o(({row:l})=>[r(v(R(l.task_type)),1)]),_:1}),e(p,{prop:"status",label:"状态",width:"100"},{default:o(({row:l})=>[e(V,{type:F(l.status)},{default:o(()=>[r(v(L(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"progress_percent",label:"进度",width:"150"},{default:o(({row:l})=>[e(O,{percentage:l.progress_percent||0,status:l.progress_percent===100?"success":""},null,8,["percentage","status"])]),_:1}),e(p,{prop:"manager_name",label:"负责人",width:"100"}),e(p,{prop:"plan_start",label:"计划开始",width:"110"}),e(p,{prop:"plan_end",label:"计划结束",width:"110"}),e(p,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[e(i,{link:"",type:"primary",onClick:S=>M(l)},{default:o(()=>[...t[15]||(t[15]=[r("查看",-1)])]),_:1},8,["onClick"]),e(i,{link:"",type:"primary",onClick:S=>q(l)},{default:o(()=>[...t[16]||(t[16]=[r("编辑",-1)])]),_:1},8,["onClick"]),l.status!=="completed"?(_(),y(i,{key:0,link:"",type:"success",onClick:S=>A(l)},{default:o(()=>[...t[17]||(t[17]=[r("报工",-1)])]),_:1},8,["onClick"])):j("",!0)]),_:1})]),_:1},8,["data"])),[[le,B.value]]),u("div",ge,[e(W,{"current-page":w.value,"onUpdate:currentPage":t[4]||(t[4]=l=>w.value=l),"page-size":h.value,"onUpdate:pageSize":t[5]||(t[5]=l=>h.value=l),total:D.value,layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50,100]},null,8,["current-page","page-size","total"])]),e(te,{modelValue:c.value,"onUpdate:modelValue":t[10]||(t[10]=l=>c.value=l),title:"任务报工",width:"500px"},{footer:o(()=>[e(i,{onClick:t[9]||(t[9]=l=>c.value=!1)},{default:o(()=>[...t[18]||(t[18]=[r("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:H,loading:b.value},{default:o(()=>[...t[19]||(t[19]=[r("提交",-1)])]),_:1},8,["loading"])]),default:o(()=>[e(ee,{model:s,"label-width":"100px"},{default:o(()=>[e(f,{label:"任务"},{default:o(()=>{var l;return[u("span",null,v((l=x.value)==null?void 0:l.name),1)]}),_:1}),e(f,{label:"今日工时"},{default:o(()=>[e(X,{modelValue:s.work_hours,"onUpdate:modelValue":t[6]||(t[6]=l=>s.work_hours=l),min:1,max:24},null,8,["modelValue"])]),_:1}),e(f,{label:"完成进度"},{default:o(()=>[e(Y,{modelValue:s.progress_percent,"onUpdate:modelValue":t[7]||(t[7]=l=>s.progress_percent=l),"show-input":""},null,8,["modelValue"])]),_:1}),e(f,{label:"工作描述"},{default:o(()=>[e(U,{modelValue:s.description,"onUpdate:modelValue":t[8]||(t[8]=l=>s.description=l),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),e(f,{label:"上传照片"},{default:o(()=>[e(Z,{action:"/api/attachments/upload","list-type":"picture-card","on-success":G},{default:o(()=>[e(k,null,{default:o(()=>[e(C)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),be=pe(fe,[["__scopeId","data-v-862f4e22"]]);export{be as default};
//# sourceMappingURL=index-CBMJ9TFm.js.map
