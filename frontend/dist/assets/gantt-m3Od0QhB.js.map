{"version":3,"file":"gantt-m3Od0QhB.js","sources":["../../src/views/tasks/gantt.vue"],"sourcesContent":["<template>\n  <div class=\"gantt-page\">\n    <!-- 顶部工具栏 -->\n    <div class=\"toolbar\">\n      <el-select v-model=\"selectedProject\" placeholder=\"选择项目\" style=\"width: 200px\">\n        <el-option v-for=\"p in projects\" :key=\"p.id\" :label=\"p.yacht_name\" :value=\"p.id\" />\n      </el-select>\n      \n      <el-radio-group v-model=\"viewMode\">\n        <el-radio-button label=\"day\">日</el-radio-button>\n        <el-radio-button label=\"week\">周</el-radio-button>\n        <el-radio-button label=\"month\">月</el-radio-button>\n      </el-radio-group>\n      \n      <el-button @click=\"$router.back()\">\n        <el-icon><ArrowLeft /></el-icon>\n        返回列表\n      </el-button>\n    </div>\n    \n    <!-- 甘特图容器 -->\n    <div class=\"gantt-container\" ref=\"ganttRef\">\n      <!-- 左侧任务列表 -->\n      <div class=\"task-list\">\n        <div class=\"task-header\">\n          <div class=\"cell\">序号</div>\n          <div class=\"cell task-name\">任务名称</div>\n          <div class=\"cell\">负责人</div>\n          <div class=\"cell\">进度</div>\n        </div>\n        \n        <div class=\"task-body\">\n          <div\n            v-for=\"task in tasks\"\n            :key=\"task.id\"\n            class=\"task-row\"\n            :class=\"{ 'task-completed': task.status === 'completed' }\"\n          >\n            <div class=\"cell\">{{ task.task_no }}</div>\n            <div class=\"cell task-name\">\n              <span :style=\"{ paddingLeft: `${(task.level - 1) * 20}px` }\">\n                <el-icon v-if=\"task.children?.length\" class=\"expand-icon\"><ArrowDown /></el-icon>\n                {{ task.name }}\n              </span>\n            </div>\n            <div class=\"cell\">{{ task.manager_name }}</div>\n            <div class=\"cell\">{{ task.progress_percent }}%</div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- 右侧时间轴 -->\n      <div class=\"timeline\">\n        <!-- 时间刻度 -->\n        <div class=\"timeline-header\">\n          <div\n            v-for=\"date in dateRange\"\n            :key=\"date\"\n            class=\"date-cell\"\n            :class=\"{ 'weekend': isWeekend(date) }\"\n          >\n            {{ formatDate(date) }}\n          </div>\n        </div>\n        \n        <!-- 任务条 -->\n        <div class=\"timeline-body\">\n          <div\n            v-for=\"task in tasks\"\n            :key=\"task.id\"\n            class=\"timeline-row\"\n          >\n            <div\n              v-if=\"task.plan_start && task.plan_end\"\n              class=\"task-bar\"\n              :class=\"`status-${task.status}`\"\n              :style=\"getTaskBarStyle(task)\"\n            >\n              <div class=\"task-progress\" :style=\"{ width: `${task.progress_percent}%` }\" />\n              <span class=\"task-label\">{{ task.name }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from 'vue'\nimport dayjs from 'dayjs'\n\nconst selectedProject = ref(1)\nconst viewMode = ref('week')\nconst ganttRef = ref()\n\nconst projects = ref([\n  { id: 1, yacht_name: '海鹰号' },\n  { id: 2, yacht_name: '蓝鲸号' }\n])\n\nconst tasks = ref([\n  {\n    id: 1,\n    task_no: '1.1',\n    name: '飞桥结构设计交付',\n    level: 1,\n    status: 'completed',\n    progress_percent: 100,\n    manager_name: '张三',\n    plan_start: '2024-01-15',\n    plan_end: '2024-02-15',\n    children: []\n  },\n  {\n    id: 2,\n    task_no: '1.2',\n    name: '船体结构生产放样及制作',\n    level: 1,\n    status: 'in_progress',\n    progress_percent: 65,\n    manager_name: '李四',\n    plan_start: '2024-02-01',\n    plan_end: '2024-04-30',\n    children: [\n      {\n        id: 21,\n        task_no: '1.2.1',\n        name: '放样',\n        level: 2,\n        status: 'completed',\n        progress_percent: 100,\n        manager_name: '王五',\n        plan_start: '2024-02-01',\n        plan_end: '2024-02-15'\n      },\n      {\n        id: 22,\n        task_no: '1.2.2',\n        name: '下料',\n        level: 2,\n        status: 'in_progress',\n        progress_percent: 80,\n        manager_name: '赵六',\n        plan_start: '2024-02-16',\n        plan_end: '2024-03-15'\n      }\n    ]\n  },\n  {\n    id: 3,\n    task_no: '1.3',\n    name: '外板及甲板矫正',\n    level: 1,\n    status: 'not_started',\n    progress_percent: 0,\n    manager_name: '王五',\n    plan_start: '2024-03-01',\n    plan_end: '2024-05-15'\n  }\n])\n\n// 展开子任务\nconst allTasks = computed(() => {\n  const result: any[] = []\n  tasks.value.forEach(task => {\n    result.push(task)\n    if (task.children) {\n      result.push(...task.children)\n    }\n  })\n  return result\n})\n\n// 日期范围\nconst dateRange = computed(() => {\n  const dates: string[] = []\n  const start = dayjs('2024-01-01')\n  const end = dayjs('2024-06-30')\n  \n  let current = start\n  while (current.isBefore(end) || current.isSame(end)) {\n    dates.push(current.format('YYYY-MM-DD'))\n    current = current.add(1, 'day')\n  }\n  \n  return dates\n})\n\nconst formatDate = (date: string) => {\n  return dayjs(date).format('MM-DD')\n}\n\nconst isWeekend = (date: string) => {\n  const day = dayjs(date).day()\n  return day === 0 || day === 6\n}\n\nconst getTaskBarStyle = (task: any) => {\n  const start = dayjs(task.plan_start)\n  const end = dayjs(task.plan_end)\n  const rangeStart = dayjs(dateRange.value[0])\n  \n  const left = start.diff(rangeStart, 'day') * 40  // 每天40px\n  const width = end.diff(start, 'day') * 40 + 40\n  \n  return {\n    left: `${left}px`,\n    width: `${width}px`\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.gantt-page {\n  height: calc(100vh - 120px);\n  display: flex;\n  flex-direction: column;\n  \n  .toolbar {\n    display: flex;\n    gap: 16px;\n    margin-bottom: 16px;\n    padding: 16px;\n    background: #fff;\n    border-radius: 8px;\n  }\n  \n  .gantt-container {\n    flex: 1;\n    display: flex;\n    background: #fff;\n    border-radius: 8px;\n    overflow: hidden;\n    \n    .task-list {\n      width: 400px;\n      border-right: 1px solid #e8e8e8;\n      \n      .task-header,\n      .task-row {\n        display: flex;\n        height: 40px;\n        line-height: 40px;\n        border-bottom: 1px solid #f0f0f0;\n        \n        .cell {\n          padding: 0 8px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          \n          &:nth-child(1) { width: 60px; }\n          &:nth-child(2) { flex: 1; }\n          &:nth-child(3) { width: 80px; }\n          &:nth-child(4) { width: 60px; }\n        }\n        \n        .task-name {\n          font-weight: 500;\n          \n          .expand-icon {\n            margin-right: 4px;\n            cursor: pointer;\n          }\n        }\n      }\n      \n      .task-header {\n        background: #fafafa;\n        font-weight: 600;\n      }\n      \n      .task-body {\n        overflow-y: auto;\n        \n        .task-row {\n          &:hover {\n            background: #f5f5f5;\n          }\n          \n          &.task-completed {\n            color: #999;\n          }\n        }\n      }\n    }\n    \n    .timeline {\n      flex: 1;\n      overflow: auto;\n      \n      .timeline-header {\n        display: flex;\n        height: 40px;\n        background: #fafafa;\n        border-bottom: 1px solid #e8e8e8;\n        \n        .date-cell {\n          width: 40px;\n          text-align: center;\n          line-height: 40px;\n          font-size: 12px;\n          border-right: 1px solid #f0f0f0;\n          \n          &.weekend {\n            background: #fff7e6;\n          }\n        }\n      }\n      \n      .timeline-body {\n        .timeline-row {\n          height: 40px;\n          border-bottom: 1px solid #f0f0f0;\n          position: relative;\n          \n          .task-bar {\n            position: absolute;\n            top: 8px;\n            height: 24px;\n            border-radius: 4px;\n            display: flex;\n            align-items: center;\n            padding: 0 8px;\n            font-size: 12px;\n            color: #fff;\n            overflow: hidden;\n            \n            .task-progress {\n              position: absolute;\n              left: 0;\n              top: 0;\n              bottom: 0;\n              background: rgba(255,255,255,0.3);\n            }\n            \n            .task-label {\n              position: relative;\n              z-index: 1;\n              white-space: nowrap;\n            }\n            \n            &.status-not_started {\n              background: #909399;\n            }\n            \n            &.status-in_progress {\n              background: #409EFF;\n            }\n            \n            &.status-completed {\n              background: #67C23A;\n            }\n            \n            &.status-delayed {\n              background: #F56C6C;\n            }\n          }\n        }\n      }\n    }\n  }\n}\n</style>\n"],"names":["selectedProject","ref","viewMode","ganttRef","projects","tasks","dateRange","computed","dates","start","dayjs","end","current","formatDate","date","isWeekend","day","getTaskBarStyle","task","rangeStart","left","width","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_select","$event","_Fragment","_renderList","p","_createBlock","_component_el_option","_component_el_radio_group","_component_el_radio_button","_cache","_component_el_button","$router","_component_el_icon","_component_ArrowLeft","_hoisted_3","_hoisted_4","_normalizeClass","_hoisted_5","_toDisplayString","_hoisted_6","_normalizeStyle","_a","_component_ArrowDown","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12"],"mappings":"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"}