import{d as se,c as x,a as v,b as l,w as t,y as re,n as k,j as r,k as R,r as o,z as ie,o as m,i as p,F as z,m as E,t as h,v as ue,q as me,E as C,A as T}from"./index-DejdUQV-.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"users"},ce={class:"toolbar"},ve={class:"filter-group"},fe={class:"user-info"},ge={class:"user-detail"},be={class:"name"},Ve={class:"username"},ye={class:"pagination"},we=se({__name:"index",setup(ke){const N=r(!1),S=r(1),$=r(20),F=r(0),f=r(!1),c=r(!1),U=r(!1),q=r(),g=R({dept:null,role:"",keyword:""}),B=r([{id:1,name:"设计部"},{id:2,name:"生产部"},{id:3,name:"采购部"},{id:4,name:"质检部"}]),j=r([{id:1,name:"结构设计组",dept_id:1},{id:2,name:"铝合金班组",dept_id:2},{id:3,name:"焊接班组",dept_id:2},{id:4,name:"采购组",dept_id:3}]),L=me(()=>n.dept_id?j.value.filter(d=>d.dept_id===n.dept_id):[]),M=r([{id:1,username:"admin",real_name:"管理员",role:"admin",dept_name:"综合部",team_name:"",phone:"13800138000",email:"admin@yacht.com",is_active:!0,last_login_at:"2024-02-15 10:30:00"},{id:2,username:"zhangsan",real_name:"张三",role:"dept_manager",dept_name:"设计部",team_name:"",phone:"13900139000",email:"zs@yacht.com",is_active:!0,last_login_at:"2024-02-14 16:45:00"},{id:3,username:"lisi",real_name:"李四",role:"team_leader",dept_name:"生产部",team_name:"铝合金班组",phone:"13700137000",email:"ls@yacht.com",is_active:!0,last_login_at:null}]),n=R({id:null,username:"",real_name:"",password:"",role:"worker",dept_id:null,team_id:null,phone:"",email:""}),A={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],real_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!c.value,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},I=d=>({admin:"danger",dept_manager:"warning",team_leader:"success",worker:""})[d]||"",O=d=>({admin:"管理员",dept_manager:"部门领导",team_leader:"班组长",worker:"工人"})[d]||d,G=()=>{c.value=!1,n.id=null,n.username="",n.real_name="",n.password="",n.role="worker",n.dept_id=null,n.team_id=null,n.phone="",n.email="",f.value=!0},H=d=>{c.value=!0,Object.assign(n,d),f.value=!0},J=()=>{n.team_id=null},K=async()=>{var a;if(await((a=q.value)==null?void 0:a.validate().catch(()=>!1))){U.value=!0;try{await new Promise(y=>setTimeout(y,500)),C.success(c.value?"更新成功":"创建成功"),f.value=!1}catch(y){C.error(y.message||"操作失败")}finally{U.value=!1}}},Q=(d,a)=>{C.success(a?"用户已启用":"用户已禁用")},W=async d=>{try{await T.confirm(`确定要重置 ${d.real_name} 的密码吗？`,"确认重置",{type:"warning"}),C.success("密码已重置为：123456")}catch{}},X=async d=>{try{await T.confirm(`确定要删除用户 ${d.real_name} 吗？`,"确认删除",{type:"warning"}),C.success("删除成功")}catch{}};return(d,a)=>{const y=o("Plus"),D=o("el-icon"),b=o("el-button"),s=o("el-option"),w=o("el-select"),Y=o("Search"),V=o("el-input"),Z=o("el-avatar"),i=o("el-table-column"),ee=o("el-tag"),le=o("el-switch"),ae=o("el-table"),te=o("el-pagination"),_=o("el-form-item"),ne=o("el-form"),oe=o("el-dialog"),de=ie("loading");return m(),x("div",_e,[v("div",ce,[l(b,{type:"primary",onClick:G},{default:t(()=>[l(D,null,{default:t(()=>[l(y)]),_:1}),a[15]||(a[15]=p(" 新建用户 ",-1))]),_:1}),v("div",ve,[l(w,{modelValue:g.dept,"onUpdate:modelValue":a[0]||(a[0]=e=>g.dept=e),placeholder:"部门",clearable:"",style:{width:"150px"}},{default:t(()=>[(m(!0),x(z,null,E(B.value,e=>(m(),k(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(w,{modelValue:g.role,"onUpdate:modelValue":a[1]||(a[1]=e=>g.role=e),placeholder:"角色",clearable:"",style:{width:"120px"}},{default:t(()=>[l(s,{label:"管理员",value:"admin"}),l(s,{label:"部门领导",value:"dept_manager"}),l(s,{label:"班组长",value:"team_leader"}),l(s,{label:"工人",value:"worker"})]),_:1},8,["modelValue"]),l(V,{modelValue:g.keyword,"onUpdate:modelValue":a[2]||(a[2]=e=>g.keyword=e),placeholder:"搜索用户名/姓名",style:{width:"200px"},clearable:""},{prefix:t(()=>[l(D,null,{default:t(()=>[l(Y)]),_:1})]),_:1},8,["modelValue"])])]),re((m(),k(ae,{data:M.value},{default:t(()=>[l(i,{label:"用户","min-width":"200"},{default:t(({row:e})=>[v("div",fe,[l(Z,{size:40,src:e.avatar_url},{default:t(()=>{var u,P;return[p(h(((u=e.real_name)==null?void 0:u[0])||((P=e.username)==null?void 0:P[0])),1)]}),_:2},1032,["src"]),v("div",ge,[v("div",be,h(e.real_name||e.username),1),v("div",Ve,h(e.username),1)])])]),_:1}),l(i,{prop:"dept_name",label:"部门",width:"120"}),l(i,{prop:"team_name",label:"班组",width:"120"}),l(i,{prop:"role",label:"角色",width:"100"},{default:t(({row:e})=>[l(ee,{type:I(e.role)},{default:t(()=>[p(h(O(e.role)),1)]),_:2},1032,["type"])]),_:1}),l(i,{prop:"phone",label:"电话",width:"130"}),l(i,{prop:"email",label:"邮箱","min-width":"180"}),l(i,{prop:"last_login_at",label:"最后登录",width:"160"},{default:t(({row:e})=>[p(h(e.last_login_at||"-"),1)]),_:1}),l(i,{label:"状态",width:"80"},{default:t(({row:e})=>[l(le,{modelValue:e.is_active,"onUpdate:modelValue":u=>e.is_active=u,onChange:u=>Q(e,u)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(i,{label:"操作",width:"180",fixed:"right"},{default:t(({row:e})=>[l(b,{link:"",type:"primary",onClick:u=>H(e)},{default:t(()=>[...a[16]||(a[16]=[p("编辑",-1)])]),_:1},8,["onClick"]),l(b,{link:"",type:"primary",onClick:u=>W(e)},{default:t(()=>[...a[17]||(a[17]=[p("重置密码",-1)])]),_:1},8,["onClick"]),l(b,{link:"",type:"danger",onClick:u=>X(e)},{default:t(()=>[...a[18]||(a[18]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,N.value]]),v("div",ye,[l(te,{"current-page":S.value,"onUpdate:currentPage":a[3]||(a[3]=e=>S.value=e),"page-size":$.value,"onUpdate:pageSize":a[4]||(a[4]=e=>$.value=e),total:F.value,layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50,100]},null,8,["current-page","page-size","total"])]),l(oe,{modelValue:f.value,"onUpdate:modelValue":a[14]||(a[14]=e=>f.value=e),title:c.value?"编辑用户":"新建用户",width:"500px"},{footer:t(()=>[l(b,{onClick:a[13]||(a[13]=e=>f.value=!1)},{default:t(()=>[...a[19]||(a[19]=[p("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:K,loading:U.value},{default:t(()=>[...a[20]||(a[20]=[p("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(ne,{model:n,rules:A,ref_key:"formRef",ref:q,"label-width":"100px"},{default:t(()=>[l(_,{label:"用户名",prop:"username"},{default:t(()=>[l(V,{modelValue:n.username,"onUpdate:modelValue":a[5]||(a[5]=e=>n.username=e),disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),l(_,{label:"姓名",prop:"real_name"},{default:t(()=>[l(V,{modelValue:n.real_name,"onUpdate:modelValue":a[6]||(a[6]=e=>n.real_name=e)},null,8,["modelValue"])]),_:1}),c.value?ue("",!0):(m(),k(_,{key:0,label:"密码",prop:"password"},{default:t(()=>[l(V,{modelValue:n.password,"onUpdate:modelValue":a[7]||(a[7]=e=>n.password=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1})),l(_,{label:"角色",prop:"role"},{default:t(()=>[l(w,{modelValue:n.role,"onUpdate:modelValue":a[8]||(a[8]=e=>n.role=e),placeholder:"选择角色"},{default:t(()=>[l(s,{label:"管理员",value:"admin"}),l(s,{label:"部门领导",value:"dept_manager"}),l(s,{label:"班组长",value:"team_leader"}),l(s,{label:"工人",value:"worker"})]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"部门"},{default:t(()=>[l(w,{modelValue:n.dept_id,"onUpdate:modelValue":a[9]||(a[9]=e=>n.dept_id=e),placeholder:"选择部门",clearable:"",onChange:J},{default:t(()=>[(m(!0),x(z,null,E(B.value,e=>(m(),k(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"班组"},{default:t(()=>[l(w,{modelValue:n.team_id,"onUpdate:modelValue":a[10]||(a[10]=e=>n.team_id=e),placeholder:"选择班组",clearable:"",disabled:!n.dept_id},{default:t(()=>[(m(!0),x(z,null,E(L.value,e=>(m(),k(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(_,{label:"电话"},{default:t(()=>[l(V,{modelValue:n.phone,"onUpdate:modelValue":a[11]||(a[11]=e=>n.phone=e)},null,8,["modelValue"])]),_:1}),l(_,{label:"邮箱"},{default:t(()=>[l(V,{modelValue:n.email,"onUpdate:modelValue":a[12]||(a[12]=e=>n.email=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),xe=pe(we,[["__scopeId","data-v-525400bd"]]);export{xe as default};
//# sourceMappingURL=index-DHjY0kRG.js.map
